# Sentiment Analysis MLOps Pipeline

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π end-to-end MLOps —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –æ—Ç–∑—ã–≤–æ–≤ (Kindle Reviews).
–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–∫—É—Å: –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ –æ–±—É—á–µ–Ω–∏—è (Spark) –∏ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ (FastAPI/Pandas) —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –¥—Ä–∏—Ñ—Ç–∞ –¥–∞–Ω–Ω—ã—Ö.

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ –¥–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∫–æ–Ω—Ç—É—Ä–∞: **Training (Batch)** –∏ **Inference (Real-time)**.

### Training Pipeline (Airflow + Spark)

–û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

1. **Ingestion**: –ó–∞–≥—Ä—É–∑–∫–∞ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (CSV/Parquet).
2. **Processing (Spark)**:
    * –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∫–ª–∞—Å—Å–æ–≤.
    * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (TF-IDF + —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∏—á–∏).
    * *–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å*: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Spark –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è ETL.
3. **Training**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π (Sklearn, LightGBM) —á–µ—Ä–µ–∑ `joblib`.
4. **Evaluation**: –í—ã–±–æ—Ä –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º (F1-score, Latency) –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ MLflow.

### Inference Service (FastAPI)

–õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

* **Stack**: FastAPI + Pandas + Joblib.
* **Feature Engineering**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ Pandas –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –æ–≤–µ—Ä—Ö–µ–¥–∞ (Spark context —Å–ª–∏—à–∫–æ–º —Ç—è–∂–µ–ª –¥–ª—è RT API).
* **Monitoring**: Prometheus (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏) + Custom Drift Monitor (PSI).

## üõ† –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

### 1. Hybrid Feature Engineering (Spark vs Pandas)

–î–ª—è –æ–±—É—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Spark, –¥–ª—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ ‚Äî Pandas.
**–ü—Ä–æ–±–ª–µ–º–∞**: –†–∏—Å–∫ Training-Serving Skew (—Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤).
**–†–µ—à–µ–Ω–∏–µ**:

* –õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ –≤ –º–æ–¥—É–ª–µ `scripts/feature_engineering.py`.
* Spark –≤—ã–∑—ã–≤–∞–µ—Ç —ç—Ç—É –ª–æ–≥–∏–∫—É —á–µ—Ä–µ–∑ UDF.
* API –≤—ã–∑—ã–≤–∞–µ—Ç –µ—ë –Ω–∞–ø—Ä—è–º—É—é.
* –ù–∞–ø–∏—Å–∞–Ω—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (`tests/test_feature_consistency.py`), –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—â–∏–µ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

### 2. "Raw" vs "Clean" Features

–ú—ã –∏–∑–≤–ª–µ–∫–∞–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ –Ω–∞ –¥–≤—É—Ö —ç—Ç–∞–ø–∞—Ö:

1. **–ü–æ —Å—ã—Ä–æ–º—É —Ç–µ–∫—Å—Ç—É**: `caps_ratio`, `exclamation_count`, `question_count` (–≤–∞–∂–Ω—ã –¥–ª—è —ç–º–æ—Ü–∏–π).
2. **–ü–æ –æ—á–∏—â–µ–Ω–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É**: TF-IDF, Word Count (–≤–∞–∂–Ω—ã –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏–∫–∏).
*–†–∞–Ω–µ–µ –±—ã–ª –±–∞–≥, –∫–æ–≥–¥–∞ –≤—Å–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å—á–∏—Ç–∞–ª–∏—Å—å –ø–æ –æ—á–∏—â–µ–Ω–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É (–≥–¥–µ —É–¥–∞–ª–µ–Ω–∞ –ø—É–Ω–∫—Ç—É–∞—Ü–∏—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä), —á—Ç–æ –æ–±–Ω—É–ª—è–ª–æ –≤–∞–∂–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ.*

### 3. Drift Monitoring

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ä–∞—Å—á–µ—Ç Population Stability Index (PSI) –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤.

* –ü—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (–∫–≤–∞–Ω—Ç–∏–ª–∏).
* –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –±–∞—Ç—á–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–≤–µ—Ä—è—é—Ç—Å—è —Å —ç—Ç–∞–ª–æ–Ω–æ–º.
* –ü—Ä–∏ PSI > 0.2 —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—Å—è –∞–ª–µ—Ä—Ç (–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ —Ä–µ—Ç—Ä–µ–π–Ω–∏–Ω–≥).

## üöÄ –ó–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* Docker & Docker Compose
* 8GB+ RAM (Spark —Ç—Ä–µ–±—É–µ—Ç –ø–∞–º—è—Ç–∏)

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
docker-compose up -d --build

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# 3. –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º:
# - Airflow: http://localhost:8080 (admin/admin)
# - MLflow: http://localhost:5000
# - API: http://localhost:8000/docs
# - Grafana: http://localhost:3000 (admin/admin)
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ unit –∏ integration —Ç–µ—Å—Ç–æ–≤
pytest tests/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
pytest tests/test_feature_consistency.py
```

## ‚ö†Ô∏è Known Issues & Roadmap (TODO)

–ß–µ—Å—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–æ–≥–æ, —á—Ç–æ –µ—â–µ –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å –¥–ª—è Production-grade —Å–æ—Å—Ç–æ—è–Ω–∏—è:

1. **Config Management**: –°–µ–π—á–∞—Å —á–∞—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–∏–º–∏—Ç—ã –∫–ª–∞—Å—Å–æ–≤) –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –≤ `config.py` –∏–ª–∏ `spark_process.py`. –ù—É–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤—Å—ë –≤ `.env` –∏–ª–∏ Hydra.
2. **CI/CD**: –ù–∞—Å—Ç—Ä–æ–µ–Ω —Ç–æ–ª—å–∫–æ –ª–∏–Ω—Ç–∏–Ω–≥. –ù—É–∂–µ–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω —Å –ø—Ä–æ–≥–æ–Ω–æ–º —Ç–µ—Å—Ç–æ–≤ –∏ —Å–±–æ—Ä–∫–æ–π Docker-–æ–±—Ä–∞–∑–æ–≤.
3. **Spark Optimization**: –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Spark (local mode) –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–¥ –∫–ª–∞—Å—Ç–µ—Ä.
4. **Security**: –°–µ–∫—Ä–µ—Ç—ã (–ø–∞—Ä–æ–ª–∏ –ë–î) –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ env-—Ñ–∞–π–ª—ã, –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω—É–∂–µ–Ω Vault.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ airflow/dags/       # DAGs –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ api_service.py          # FastAPI app
‚îÇ   ‚îú‚îÄ‚îÄ spark_process.py        # ETL logic (Spark)
‚îÇ   ‚îú‚îÄ‚îÄ feature_engineering.py  # Shared feature logic (Core!)
‚îÇ   ‚îú‚îÄ‚îÄ train.py                # Training script
‚îÇ   ‚îî‚îÄ‚îÄ drift_monitor.py        # Drift detection
‚îú‚îÄ‚îÄ tests/              # Pytest tests
‚îú‚îÄ‚îÄ docker-compose.yml  # Infra definition
‚îî‚îÄ‚îÄ README.md           # This file
```
