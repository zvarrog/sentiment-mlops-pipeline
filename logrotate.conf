# Logrotate configuration for Kindle Reviews MLOps pipeline
# Prevents logs from filling disk space

# Airflow logs
/opt/airflow/logs/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 airflow airflow
    sharedscripts
    postrotate
        # Reload airflow if needed
        systemctl reload airflow 2>/dev/null || true
    endscript
}

# API logs (if logging to file)
/var/log/kindle_api/*.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data www-data
    maxsize 100M
    sharedscripts
    postrotate
        # Graceful reload API
        docker-compose restart api 2>/dev/null || true
    endscript
}

# Training logs
/opt/airflow/logs/training/*.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 0640 airflow airflow
    maxsize 500M
}

# MLflow logs
/mlflow/logs/*.log {
    weekly
    rotate 8
    compress
    delaycompress
    missingok
    notifempty
    create 0640 mlflow mlflow
}
